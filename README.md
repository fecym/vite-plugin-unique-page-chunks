# Vite é¡µé¢ç»„ä»¶å”¯ä¸€åˆ†å—æ’ä»¶

## ğŸ¯ æ’ä»¶ç®€ä»‹

`vite-plugin-unique-page-chunks` æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„Viteæ’ä»¶ï¼Œä¸“é—¨è§£å†³ Vite æ„å»ºæ—¶å¯¹äºåŒåç»„ä»¶ï¼ˆå¦‚å¤šä¸ª `index.vue`ï¼‰ç”Ÿæˆçš„ chunk å‘½åå†²çªé—®é¢˜ã€‚

**é—®é¢˜èƒŒæ™¯**ï¼šVite é»˜è®¤ä¼šä¸ºæ¯ä¸ªç»„ä»¶ç”Ÿæˆå¯¹åº”çš„ JS æ–‡ä»¶ï¼Œä½†å½“é¡¹ç›®ä¸­æœ‰å¤šä¸ªåŒåæ–‡ä»¶ï¼ˆå¦‚ä¸åŒç›®å½•ä¸‹çš„ `index.vue`ï¼‰æ—¶ï¼Œå®ƒä»¬ä¼šç”ŸæˆåŒåçš„ JS æ–‡ä»¶ï¼Œå¯¼è‡´æ— æ³•åŒºåˆ†ä¸åŒé¡µé¢çš„ chunkã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šæœ¬æ’ä»¶è‡ªåŠ¨æ‰«æé¡¹ç›®ä¸­æŒ‡å®šçš„é¡µé¢ç»„ä»¶ï¼Œå¹¶æ ¹æ®å…¶æ‰€åœ¨ç›®å½•åä¸ºæ¯ä¸ªé¡µé¢ç”Ÿæˆå¸¦æœ‰å”¯ä¸€å‰ç¼€çš„ç‹¬ç«‹ chunkï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ã€‚

**âš ï¸ é‡è¦è¯´æ˜**ï¼šæ­¤æ’ä»¶ä»…åœ¨**ç”Ÿäº§ç¯å¢ƒæ„å»º**æ—¶ç”Ÿæ•ˆï¼Œå¼€å‘ç¯å¢ƒä¸‹ä¸ä¼šè¿›è¡Œä»£ç åˆ†å‰²ï¼Œä»¥ä¿è¯å¼€å‘æ—¶çš„çƒ­æ›´æ–°æ€§èƒ½ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ” è‡ªåŠ¨è¯†åˆ«é¡µé¢ç»„ä»¶
- è‡ªåŠ¨æ‰«ææŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰é¡µé¢ç»„ä»¶
- æ”¯æŒè‡ªå®šä¹‰é¡µé¢å…¥å£æ–‡ä»¶æ¨¡å¼ï¼ˆé»˜è®¤ï¼š`index.vue`ï¼‰
- è§£å†³åŒåç»„ä»¶ç”ŸæˆåŒå chunk çš„å†²çªé—®é¢˜

### ğŸ“¦ æ™ºèƒ½å‘½åä¸åˆ†ç»„
- æ ¹æ®ç›®å½•åè‡ªåŠ¨ç”Ÿæˆå”¯ä¸€çš„ chunk åç§°
- é¡µé¢ç›¸å…³ç»„ä»¶è‡ªåŠ¨å½’å…¥å¯¹åº”é¡µé¢ chunk
- æ”¯æŒè‡ªå®šä¹‰ chunk å‘½åå‰ç¼€

### ğŸ› ï¸ çµæ´»é…ç½®
- æ”¯æŒè‡ªå®šä¹‰æ‰«æç›®å½•
- æ”¯æŒåŒ…å«/æ’é™¤ç‰¹å®šæ–‡ä»¶
- æ”¯æŒé€šé…ç¬¦åŒ¹é…

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä½¿ç”¨

```bash
npm install vite-plugin-unique-page-chunks --save-dev
# æˆ–è€…
yarn add vite-plugin-unique-page-chunks -D
# æˆ–è€…
pnpm add vite-plugin-unique-page-chunks -D
```

```javascript
// vite.config.js
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { uniquePageChunks } from 'vite-plugin-unique-page-chunks'

export default defineConfig({
  plugins: [
    vue(),
    uniquePageChunks({
      viewsDir: 'src/views',      // é¡µé¢ç›®å½•ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
      chunkPrefix: 'page-',       // chunkåç§°å‰ç¼€
      include: ['index.vue'],     // åŒ…å«çš„æ–‡ä»¶ï¼ˆå¯æ ¹æ®é¡¹ç›®è§„èŒƒè°ƒæ•´ï¼‰
      exclude: [],                // æ’é™¤çš„é¡µé¢
      chunkFileNames: {
        pageChunkPath: 'assets/js/pages/[name]-[hash].js',
        defaultChunkPath: 'assets/js/[name]-[hash].js'
      }
    })
  ]
})
```

### 2. å‘½åå†²çªé—®é¢˜ç¤ºä¾‹

**é—®é¢˜ç¤ºä¾‹**ï¼š

```txt
é¡¹ç›®ç›®å½•/
â”œâ”€â”€ PageA/
â”‚   â””â”€â”€ index.vue              # é»˜è®¤æƒ…å†µä¸‹ç”Ÿæˆ -> index.js
â”œâ”€â”€ PageB/
â”‚   â””â”€â”€ index.vue              # é»˜è®¤æƒ…å†µä¸‹ä¹Ÿç”Ÿæˆ -> index.js (å‘½åå†²çª!)
â””â”€â”€ PageC/
â””â”€â”€ index.vue              # é»˜è®¤æƒ…å†µä¸‹ä¹Ÿç”Ÿæˆ -> index.js (å‘½åå†²çª!)
```


**ä½¿ç”¨æ’ä»¶å**ï¼š

```txt
dist/assets/js/pages/
â”œâ”€â”€ page-pagea-a1b2c3d4.js     # PageA/index.vue åŠå…¶ç›¸å…³ç»„ä»¶
â”œâ”€â”€ page-pageb-e5f6g7h8.js     # PageB/index.vue åŠå…¶ç›¸å…³ç»„ä»¶
â””â”€â”€ page-pagec-i9j0k1l2.js     # PageC/index.vue åŠå…¶ç›¸å…³ç»„ä»¶
```


## âš™ï¸ é…ç½®é€‰é¡¹

### åŸºç¡€é…ç½®

```javascript
uniquePageChunks({
  // é¡µé¢ç›®å½•è·¯å¾„ï¼ˆç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•ï¼‰
  viewsDir: 'src/views',
  
  // chunkåç§°å‰ç¼€ï¼ˆç”¨äºåŒºåˆ†ä¸åŒé¡µé¢çš„chunkï¼‰
  chunkPrefix: 'page-',
  
  // åŒ…å«çš„æ–‡ä»¶æ¨¡å¼ï¼ˆç”¨äºè¯†åˆ«é¡µé¢å…¥å£ï¼‰
  include: ['index.vue'],
  
  // æ’é™¤çš„é¡µé¢ç›®å½•
  exclude: ['components', 'shared'],
  
  // è‡ªå®šä¹‰chunkæ–‡ä»¶å‘½åé…ç½®
  chunkFileNames: {
    pageChunkPath: 'assets/js/pages/[name]-[hash].js',
    defaultChunkPath: 'assets/js/[name]-[hash].js'
  }
})
```

### é«˜çº§é…ç½®

```javascript
uniquePageChunks({
  // é€‚åº”ä¸åŒé¡¹ç›®ç»“æ„
  viewsDir: 'src/pages',
  chunkPrefix: 'route-',
  
  // æ”¯æŒé€šé…ç¬¦åŒ¹é…ï¼Œé€‚åº”ä¸åŒå‘½åè§„èŒƒ
  include: ['*.vue', 'main.vue', 'Page.vue'],
  
  // æ’é™¤ç‰¹å®šé¡µé¢
  exclude: ['admin', 'test']
})
```

## ğŸ¨ é€‚åº”ä¸åŒé¡¹ç›®è§„èŒƒ

### 1. é€‚åº”ä¸åŒçš„ç›®å½•ç»“æ„

æ’ä»¶å¯ä»¥é€‚åº”å„ç§é¡¹ç›®ç»“æ„ï¼Œåªéœ€è°ƒæ•´é…ç½®ï¼š

```javascript
// æ ‡å‡† Vue é¡¹ç›®
uniquePageChunks({ viewsDir: 'src/views' })

// Nuxt é£æ ¼é¡¹ç›®
uniquePageChunks({ viewsDir: 'src/pages' })

// è‡ªå®šä¹‰ç»“æ„
uniquePageChunks({ viewsDir: 'src/modules' })
```

### 2. é€‚åº”ä¸åŒçš„æ–‡ä»¶å‘½åè§„èŒƒ

æ’ä»¶æ”¯æŒå¤šç§æ–‡ä»¶å‘½åè§„èŒƒï¼Œé€šè¿‡ `include` é…ç½®ï¼š

```javascript
// index.vue ä½œä¸ºå…¥å£
uniquePageChunks({ include: ['index.vue'] })

// [name].page.vue ä½œä¸ºå…¥å£
uniquePageChunks({ include: ['*.page.vue'] })

// å¤šç§å¯èƒ½çš„å…¥å£æ–‡ä»¶
uniquePageChunks({ include: ['index.vue', 'main.vue', '*.page.vue'] })
```

### 3. æ’é™¤ç‰¹å®šé¡µé¢æˆ–ç›®å½•

```javascript
uniquePageChunks({
  exclude: ['admin', 'components', 'utils']  // è¿™äº›ç›®å½•ä¸ä¼šç”Ÿæˆç‹¬ç«‹chunk
})
```

## ğŸ“Š æ€§èƒ½ä¼˜åŠ¿

### ğŸš€ æ„å»ºä¼˜åŠ¿

| å¯¹æ¯”é¡¹ | Vite é»˜è®¤è¡Œä¸º | ä½¿ç”¨æœ¬æ’ä»¶ |
|--------|----------|----------|
| **chunkå‘½å** | åŒåå†²çª | å”¯ä¸€å‘½å |
| **å¯è¯»æ€§** | ä½ï¼ˆæ— æ³•åŒºåˆ†é¡µé¢ï¼‰ | é«˜ï¼ˆæ¸…æ™°çš„é¡µé¢å‰ç¼€ï¼‰ |
| **ç¼“å­˜æ•ˆç‡** | ä½ï¼ˆæ›´æ–°ä¸€ä¸ªé¡µé¢å¯èƒ½å½±å“å¤šä¸ªï¼‰ | é«˜ï¼ˆé¡µé¢ç‹¬ç«‹ç¼“å­˜ï¼‰ |
| **ç»´æŠ¤æˆæœ¬** | é«˜ï¼ˆéœ€æ‰‹åŠ¨é…ç½®ï¼‰ | ä½ï¼ˆè‡ªåŠ¨å¤„ç†ï¼‰ |

### ğŸ“ˆ è¿è¡Œæ—¶æ€§èƒ½

- âœ… **æŒ‰éœ€åŠ è½½**ï¼šæ¯ä¸ªé¡µé¢ç‹¬ç«‹chunkï¼Œè®¿é—®æ—¶æ‰åŠ è½½
- âœ… **ç¼“å­˜ä¼˜åŒ–**ï¼šé¡µé¢ç‹¬ç«‹æ›´æ–°ï¼Œä¸å½±å“å…¶ä»–é¡µé¢ç¼“å­˜
- âœ… **å¹¶è¡ŒåŠ è½½**ï¼šå¤šä¸ªé¡µé¢å¯ä»¥å¹¶è¡Œé¢„åŠ è½½
- âœ… **ä½“ç§¯ä¼˜åŒ–**ï¼šé¿å…ä¸å¿…è¦çš„ä»£ç æ‰“åŒ…

## ğŸ› ï¸ è°ƒè¯•å’Œç›‘æ§

### 1. æ„å»ºæ—¥å¿—

æ’ä»¶ä¼šåœ¨æ„å»ºæ—¶è¾“å‡ºè¯¦ç»†ä¿¡æ¯ï¼š

```txt
ğŸš€ [unique-page-chunks] è‡ªåŠ¨ç”Ÿæˆäº† 6 ä¸ªé¡µé¢chunks:
   - page-pagea
   - page-pageb
   - page-pagec
   - page-paged
   - page-pagee
   - page-pagef
ğŸ“ [unique-page-chunks] é¡µé¢chunkå°†ä¿å­˜åˆ°: assets/js/pages/[name]-[hash].js
```

### 2. åˆ†æå·¥å…·

ç»“åˆ `rollup-plugin-visualizer` æŸ¥çœ‹chunkåˆ†æï¼š

```javascript
// vite.config.js
import { visualizer } from 'rollup-plugin-visualizer'

export default defineConfig({
  plugins: [
    uniquePageChunks(),
    visualizer({
      filename: 'dist/stats.html',
      open: false,
      gzipSize: true,
      brotliSize: true
    })
  ]
})
```

è®¿é—® `dist/stats.html` æŸ¥çœ‹è¯¦ç»†çš„chunkåˆ†ææŠ¥å‘Šã€‚

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æŸä¸ªé¡µé¢æ²¡æœ‰ç”Ÿæˆç‹¬ç«‹chunkï¼Ÿ**

A: æ£€æŸ¥é¡µé¢ç›®å½•ä¸‹æ˜¯å¦æœ‰ç¬¦åˆ `include` é…ç½®çš„æ–‡ä»¶ï¼Œæˆ–è€…è¯¥é¡µé¢æ˜¯å¦åœ¨ `exclude` åˆ—è¡¨ä¸­ã€‚

**Q: é¡µé¢ç›¸å…³ç»„ä»¶æ²¡æœ‰åŒ…å«åœ¨å¯¹åº”chunkä¸­ï¼Ÿ**

A: æ£€æŸ¥ç»„ä»¶æ˜¯å¦ä½äºæ­£ç¡®çš„å­ç›®å½•ä¸­ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨åŒ…å« `components/`ã€`composables/` å’Œ `utils/` å­ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚

**Q: æ’ä»¶æŠ¥é”™æ— æ³•æ‰«æç›®å½•ï¼Ÿ**

A: æ£€æŸ¥ `viewsDir` é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œç›®å½•æ˜¯å¦å­˜åœ¨ã€‚

**Q: ä¸ºä»€ä¹ˆå¼€å‘ç¯å¢ƒä¸­çœ‹ä¸åˆ°æ•ˆæœï¼Ÿ**

A: æ’ä»¶ä»…åœ¨ç”Ÿäº§ç¯å¢ƒæ„å»ºæ—¶ç”Ÿæ•ˆï¼Œå¼€å‘ç¯å¢ƒä¸‹ä¸ä¼šè¿›è¡Œä»£ç åˆ†å‰²ï¼Œä»¥ä¿è¯çƒ­æ›´æ–°æ€§èƒ½ã€‚

## ğŸ“ æ€»ç»“

ä½¿ç”¨ `vite-plugin-unique-page-chunks` æ’ä»¶ï¼Œä½ å¯ä»¥ï¼š

- âœ… **è§£å†³å‘½åå†²çª**ï¼šä¸åŒé¡µé¢çš„åŒåç»„ä»¶ç”Ÿæˆå”¯ä¸€å‘½åçš„ chunk
- âœ… **é€‚åº”ä¸åŒè§„èŒƒ**ï¼šçµæ´»é…ç½®é€‚åº”å„ç§é¡¹ç›®ç»“æ„å’Œå‘½åè§„èŒƒ
- âœ… **é›¶é…ç½®ç»´æŠ¤**ï¼šæ·»åŠ æ–°é¡µé¢æ— éœ€ä¿®æ”¹é…ç½®
- âœ… **è‡ªåŠ¨åŒ–å¤„ç†**ï¼šæ™ºèƒ½æ‰«æå’Œchunkç”Ÿæˆ
- âœ… **é«˜æ€§èƒ½æ„å»º**ï¼šä¼˜åŒ–çš„ä»£ç åˆ†å‰²ç­–ç•¥

è¿™ä¸ªæ’ä»¶å®Œç¾è§£å†³äº† Vite é»˜è®¤æ„å»ºä¸­åŒåç»„ä»¶ç”ŸæˆåŒå chunk çš„é—®é¢˜ï¼Œè®©ä½ çš„é¡¹ç›®æ„å»ºæ›´åŠ æ¸…æ™°ã€é«˜æ•ˆï¼
