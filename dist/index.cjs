"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("path"),t=require("fs");function n(n={}){const{viewsDir:s="src/views",chunkPrefix:o="page-",include:r=["index.vue"],exclude:i=[],chunkFileNames:l={pageChunkPath:"assets/js/pages/[name]-[hash].js",defaultChunkPath:"assets/js/[name]-[hash].js"},pluginPriority:c=!0}=n;return{name:"vite-plugin-unique-page-chunks",config(n,{command:a}){if("build"!==a)return;const p=function(n,s,o,r){const i={},l=e.resolve(process.cwd(),n);try{t.readdirSync(l).forEach(c=>{const a=e.resolve(l,c);if(!t.statSync(a).isDirectory())return;if(r.includes(c))return;const p=t.readdirSync(a).filter(e=>o.some(t=>{if(t.includes("*")){return new RegExp(t.replace(/\*/g,".*")).test(e)}return e===t}));if(p.length>0){const o=`${s}${c.toLowerCase()}`;i[o]=p.map(e=>`./${n}/${c}/${e}`.replace(/\\/g,"/"));["components","composables","utils"].forEach(n=>{const s=e.resolve(a,n);try{if(t.statSync(s).isDirectory()){u(s).forEach(t=>{const n=e.relative(process.cwd(),t).replace(/\\/g,"/");i[o].push(`./${n}`)})}}catch(e){}})}})}catch(e){console.warn(`âš ï¸  [unique-page-chunks] æ— æ³•æ‰«æç›®å½• ${n}:`,e.message)}return i}(s,o,r,i);n.build||(n.build={}),n.build.rollupOptions||(n.build.rollupOptions={}),n.build.rollupOptions.output||(n.build.rollupOptions.output={});const h=n.build.rollupOptions.output.manualChunks||{};if("function"==typeof h){const t=h,u=t=>{const n=`./${e.relative(process.cwd(),t).replace(/\\/g,"/")}`;for(const[e,t]of Object.entries(p))if(t.includes(n))return e;return null};n.build.rollupOptions.output.manualChunks=e=>c?u(e)||t(e):t(e)||u(e)}else n.build.rollupOptions.output.manualChunks=c?{...h,...p}:{...p,...h};const d=n.build.rollupOptions.output.chunkFileNames,f=e=>null!=e&&e.name.startsWith(o)?l.pageChunkPath:null;if("function"==typeof d){const e=d;n.build.rollupOptions.output.chunkFileNames=t=>f(t)||e(t)}else n.build.rollupOptions.output.chunkFileNames="string"==typeof d?e=>f(e)||d:e=>f(e)||l.defaultChunkPath;console.log(`ðŸš€ [unique-page-chunks] è‡ªåŠ¨ç”Ÿæˆäº† ${Object.keys(p).length} ä¸ªé¡µé¢chunks:`),Object.keys(p).forEach(e=>{console.log(`   - ${e}`)}),console.log(`ðŸ“ [unique-page-chunks] é¡µé¢chunkå°†ä¿å­˜åˆ°: ${l.pageChunkPath}`)}}}function u(n){const s=[];try{t.readdirSync(n).forEach(o=>{const r=e.resolve(n,o);t.statSync(r).isDirectory()?s.push(...u(r)):(o.endsWith(".vue")||o.endsWith(".js")||o.endsWith(".ts"))&&s.push(r)})}catch(e){}return s}exports.default=n,exports.uniquePageChunks=n;
