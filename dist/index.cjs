"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("path"),t=require("fs");function n(n={}){const{viewsDir:u="src/views",chunkPrefix:o="page-",include:r=["index.vue"],exclude:i=[],chunkFileNames:c={pageChunkPath:"assets/js/pages/[name]-[hash].js",defaultChunkPath:"assets/js/[name]-[hash].js"}}=n;return{name:"vite-plugin-unique-page-chunks",config(n,{command:a}){if("build"!==a)return;const l=function(n,u,o,r){const i={},c=e.resolve(process.cwd(),n);try{t.readdirSync(c).forEach(a=>{const l=e.resolve(c,a);if(!t.statSync(l).isDirectory())return;if(r.includes(a))return;const p=t.readdirSync(l).filter(e=>o.some(t=>{if(t.includes("*")){return new RegExp(t.replace(/\*/g,".*")).test(e)}return e===t}));if(p.length>0){const o=`${u}${a.toLowerCase()}`;i[o]=p.map(e=>`./${n}/${a}/${e}`.replace(/\\/g,"/"));["components","composables","utils"].forEach(n=>{const u=e.resolve(l,n);try{if(t.statSync(u).isDirectory()){s(u).forEach(t=>{const n=e.relative(process.cwd(),t).replace(/\\/g,"/");i[o].push(`./${n}`)})}}catch(e){}})}})}catch(e){console.warn(`âš ï¸  [unique-page-chunks] æ— æ³•æ‰«æç›®å½• ${n}:`,e.message)}return i}(u,o,r,i);n.build||(n.build={}),n.build.rollupOptions||(n.build.rollupOptions={}),n.build.rollupOptions.output||(n.build.rollupOptions.output={});const p=n.build.rollupOptions.output.manualChunks||{};if("function"==typeof p){const e=p;n.build.rollupOptions.output.manualChunks=t=>{for(const[e,n]of Object.entries(l))if(n.some(e=>t.includes(e)))return e;return e(t)}}else n.build.rollupOptions.output.manualChunks={...p,...l};const h=n.build.rollupOptions.output.chunkFileNames;if("function"==typeof h){const e=h;n.build.rollupOptions.output.chunkFileNames=t=>t.name&&t.name.startsWith(o)?c.pageChunkPath:e(t)}else n.build.rollupOptions.output.chunkFileNames="string"==typeof h?e=>e.name&&e.name.startsWith(o)?c.pageChunkPath:h:e=>e.name&&e.name.startsWith(o)?c.pageChunkPath:c.defaultChunkPath;console.log(`ðŸš€ [unique-page-chunks] è‡ªåŠ¨ç”Ÿæˆäº† ${Object.keys(l).length} ä¸ªé¡µé¢chunks:`),Object.keys(l).forEach(e=>{console.log(`   - ${e}`)}),console.log(`ðŸ“ [unique-page-chunks] é¡µé¢chunkå°†ä¿å­˜åˆ°: ${c.pageChunkPath}`)}}}function s(n){const u=[];try{t.readdirSync(n).forEach(o=>{const r=e.resolve(n,o);t.statSync(r).isDirectory()?u.push(...s(r)):(o.endsWith(".vue")||o.endsWith(".js")||o.endsWith(".ts"))&&u.push(r)})}catch(e){}return u}exports.default=n,exports.uniquePageChunks=n;
